@if(uploadSheetMusicService.isOpen){

  <div class="modal-backdrop" (click)="onCancel()">

    <form class="modal-container"
          [formGroup]="uploadForm"
          (click)="$event.stopPropagation()"
          (submit)="onSubmit()">

      <!-- 爪 砖: PDF + 转 -->
      <div class="modal-left">

        <label>Upload PDF Score</label>

        <div class="drop-zone"
             (click)="pdfInput.click()"
             (drop)="onFileDrop($event)"
             (dragover)="onFileDragOver($event)">
             
          <div class="drop-icon"></div>
          <p>Drop PDF files here</p>

          <input type="file"
                 #pdfInput
                 style="display:none"
                 (change)="onFileSelected($event)"
                 accept=".pdf" />
        </div>

        <div class="upload-container">
          <button type="button"
                  class="upload-photo"
                  (click)="imageInput.click()"
                  [disabled]="!aiDataAnalyzed">

            <img *ngIf="imageCoverUrl"
                 [src]="imageCoverUrl"
                 class="uploaded-image-preview" />

            <span *ngIf="!imageCoverUrl">Upload Cover</span>
          </button>

          <input type="file"
                 #imageInput
                 (change)="onImageSelected($event)"
                 style="display:none"
                 accept="image/*" />

          <p class="optional-text">(Optional)</p>
        </div>

      </div>

      <!-- 爪 : 砖转 + 驻转专 AI -->
      <div class="modal-right">

        <button type="button"
                class="button"
                [disabled]="isLoading || aiDataAnalyzed || !selectedFile"
                (click)="analyzePDF()">
          <mat-icon>smart_toy</mat-icon>
          Analyze with AI
        </button>

        <!-- 砖转 -->
        <div class="input-row">
          <div class="input-group">
            <label>Title</label>
            <input formControlName="title" />
          </div>

          <div class="input-group">
            <label>Key/Scale</label>
            <select formControlName="scale">
              <option value="" disabled>Select key...</option>
              <option *ngFor="let scale of scaleOptions" [value]="scale">{{ scale }}</option>
            </select>
          </div>
        </div>

        <div class="input-row">
          <div class="input-group">
            <label>Composer</label>
            <input formControlName="composer" />
          </div>

          <div class="input-group">
            <label>Lyricist</label>
            <input formControlName="lyricist" />
          </div>
        </div>

        <div class="input-row">
          <div class="input-group">
            <label>Categories</label>
            <select formControlName="categories" multiple>
              <option *ngFor="let cat of categories" [value]="cat.id">{{ cat.name }}</option>
            </select>
          </div>

          <div class="input-group">
            <label>Difficulty Level</label>
            <select formControlName="level">
              <option value="" disabled>Select level...</option>
              <option *ngFor="let level of difficultyLevels" [value]="level">{{ level }}</option>
            </select>
          </div>
        </div>

        <div class="input-row full-width">
          <div class="input-group full-width">
            <label>Instruments</label>
            <select formControlName="instruments" multiple>
              <option *ngFor="let inst of instrumentsList" [value]="inst.id">
                {{ inst.name }}
              </option>
            </select>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="cancel-btn" (click)="onCancel()">Cancel</button>
          <button type="submit"
                  class="button"
                  [disabled]="!uploadForm.valid || !selectedFile || isLoading">
            Save Sheet
          </button>
        </div>

      </div>
    </form>

  </div>

}







<!-- @if(uploadSheetMusicService.isOpen){
<div class="modal-backdrop" (click)="onCancel()"> 
  <div class="modal-container" (click)="$event.stopPropagation()">
   <div class="modal-header">
    <h2>Upload Music Sheet</h2>
    <button class="close-btn" (click)="onCancel()">
     <span aria-hidden="true" >&times;</span>
    </button>
   </div>

   <form [formGroup]="uploadForm" (ngSubmit)="onSubmit()">
    
        <div class="input-row">
     <div class="input-group">
      <label for="title">Title</label>
      <input id="title" type="text" formControlName="title" placeholder="Sheet title..." required />
            @if (uploadForm.get('title')?.invalid && uploadForm.get('title')?.touched) {
                <div class="error-message">Title is required.</div>
            }
     </div>
          
     <div class="input-group">
      <label for="key">Key / Scale</label>
      <select id="key" formControlName="key" required>
       <option value="" disabled>Select key...</option>
              @for (scale of scaleOptions; track scale) {
                <option [value]="scale">{{ scale }}</option>
              }
      </select>
            @if (uploadForm.get('key')?.invalid && uploadForm.get('key')?.touched) {
                <div class="error-message">Key/Scale is required.</div>
            }
     </div>
    </div>

        <div class="input-row">
     <div class="input-group">
      <label for="category">Category</label>
      <select id="category" formControlName="category" required>
       <option value="" disabled>Select category...</option>
              @for (cat of categories; track cat.id) {
         <option [value]="cat.id">{{ cat.name }}</option>
              }
      </select>
            @if (uploadForm.get('category')?.invalid && uploadForm.get('category')?.touched) {
                <div class="error-message">Category is required.</div>
            }
     </div>
          
          <div class="input-group">
      <label for="level">Difficulty Level</label>
      <select id="level" formControlName="level" required>
       <option value="" disabled>Select level...</option>
              @for (level of difficultyLevels; track level) {
                <option [value]="level">{{ level }}</option>
              }
      </select>
            @if (uploadForm.get('level')?.invalid && uploadForm.get('level')?.touched) {
                <div class="error-message">Level is required.</div>
            }
     </div>
    </div>
        
        <div class="input-row">
     <div class="input-group full-width">
      <label for="description">Description (Optional)</label>
      <input id="description" type="text" formControlName="description" placeholder="Short description of the sheet..." />
     </div>
    </div>

        <div class="input-row">
     <div class="input-group full-width">
      <label for="instruments">Instruments (Multi-select)</label>
      <select id="instruments" formControlName="instruments" multiple size="4">
              @for (inst of instrumentsList; track inst.id) {
          <option [value]="inst.id">{{ inst.name }}</option>
              }
      </select>
     </div>
    </div>

        <div class="upload-section">
     <label>Upload Files</label>
     <div class="drop-zone" (click)="fileInput.click()" (drop)="onFileDrop($event)" (dragover)="onFileDragOver($event)">
      <div class="drop-icon"></div>
      <p>{{ selectedFile ? selectedFile.name : 'Drop PDF files here' }}</p>
      <p class="supported-formats">Supported formats: PDF</p>
      <input type="file" #fileInput (change)="onFileSelect($event)" style="display: none;" accept=".pdf" />
     </div>
         @if (!selectedFile && uploadForm.touched) { 
    <div class="error-message">A file is required for upload.</div>
}
          @if (uploadError) {
            <div class="error-message general-error">{{ uploadError }}</div>
          }
    </div>

        <div class="modal-footer">
     <button type="button" class="cancel-btn" (click)="onCancel()">Cancel</button>
     <button type="submit" class="button" [disabled]="!uploadForm.valid || !selectedFile || isLoading">
            @if (isLoading) {
                <span>Uploading...</span>
            } @else {
                <span>Upload Sheet</span>
            }
          </button>
    </div>
   </form>
  </div>
</div>
} -->

