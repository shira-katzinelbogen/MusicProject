<div class="container">

  <header class="header">
    <div class="cover-wrapper">
      <img src="./assets/images/sheets_music.webp" class="cover-image" />

      <div class="overlay-content">
        <div class="title-section">
          <h1 class="musicians" style="font-size: 60px;">Sheet Music Library</h1>
          <p style="font-size: 25px; color: #ffffff;">
            Discover, learn, and share musical scores from around the world
          </p>
        </div>

        <button class="button join-network-btn" (click)="openUploadModal()">
          <mat-icon>upload</mat-icon>
          UploadSheetMusic
        </button>
      </div>
    </div>
  </header>

   <section class="search-bar">
        <div class="search-input-group">
            <span class="search-icon">ğŸ”</span>
            <input type="text" placeholder="Search musicians by name, instrument, or skills..." />
        </div>
        <select class="dropdown">
            <option>All</option>
        </select>
        <select class="dropdown">
            <option>All</option>
        </select>

        <button class="filters-btn" (click)="toggleFilters()">
            Filters <span class="arrow-icon">{{ showFilters ? 'âˆ§' : 'âˆ¨' }}</span>
        </button>
    </section>
  @if (showFilters) {
Â  Â  <section class="additional-filters">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="filter-group">
Â  Â  Â  Â  Â  Â  <label>×›×œ×™ × ×’×™× ×”</label>
Â  Â  Â  Â  Â  Â  <select class="dropdown" 
                    [(ngModel)]="selectedInstrument" 
                    (change)="applyFilters()">
Â  Â  Â  Â  Â  Â  Â  Â  @for (instrument of instruments; track instrument) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option [value]="instrument">{{ instrument }}</option>
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="filter-group">
Â  Â  Â  Â  Â  Â  <label>×¡×•×œ×</label>
Â  Â  Â  Â  Â  Â  <select class="dropdown" 
                    [(ngModel)]="selectedScale" 
                    (change)="applyFilters()">
Â  Â  Â  Â  Â  Â  Â  Â  @for (scale of scales; track scale) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option [value]="scale">{{ scale }}</option>
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="filter-group">
Â  Â  Â  Â  Â  Â  <label>×¨××ª ×§×•×©×™</label>
Â  Â  Â  Â  Â  Â  <select class="dropdown" 
                    [(ngModel)]="selectedLevel" 
                    (change)="applyFilters()">
Â  Â  Â  Â  Â  Â  Â  Â  @for (level of levels; track level) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option [value]="level">{{ level }}</option>
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  </div>
Â  Â  </section>
Â  Â  }

  <div class="sheet-music-container">

    @for (sheet of sheetMusicList; track sheet.id) {

      <div class="music-card">

        <!-- HEADER (IMAGE + TAGS) -->
        <div class="sheet-cover-header">

          <div class="cover-image">
            <div class="pdf-preview-half">

              @if (sheet.filePath) {
                <iframe
                  [src]="getSafeMediaUrl(sheet.filePath)"
                  class="file-preview-iframe"
                  title="×ª×¦×•×’×” ××§×“×™××” ×©×œ {{ sheet.name }}"
                  allowfullscreen>
                </iframe>
              }
              @else {
                <div class="no-preview-overlay">××™×Ÿ ×ª×¦×•×’×” ××§×“×™××”</div>
              }

            </div>
          </div>

          <div class="badge-group">
            <span class="badge category">
              <mat-icon>folder</mat-icon>
              {{ sheet.category?.name }}
            </span>

            <span class="badge difficulty {{ sheet.level }}">
              {{ sheet.level }}
            </span>
          </div>

        </div>

        <!-- BODY -->
        <div class="card-content">

          <h3 class="title">{{ sheet.name }}</h3>

          <p class="artist-legacy">
            <span
              class="artist-mini-profile"
              (click)="navigationService.goToProfile(sheet.user!.id!)">

              <img
                [src]="fileUtilsService.getImageUrl(sheet.user!.imageProfilePath)"
                class="artist-mini-img"
                alt="Profile" />

              <span>{{ sheet.user!.name }}</span>
            </span>
          </p>

          <div class="details-row">
            <div class="primary-tags">

              <span class="detail-tag">
                <mat-icon>description</mat-icon>
                {{ sheet.pages }}
              </span>

              <span class="detail-tag">
                <mat-icon>music_note</mat-icon>
                {{ sheet.scale }}
              </span>

              <span class="detail-tag">
                @for (instrument of sheet.instruments; track instrument.id) {
                  {{ instrument.name }}
                  @if (!$last) { <span>, </span> }
                }
              </span>

            </div>
          </div>

          <div class="stats-row">
            <span class="stat-item">
              <mat-icon>download</mat-icon>
              {{ sheet.downloads }}
            </span>
          </div>

          <span class="stat-item likes" (click)="toggleLike(sheet)">
            <mat-icon style="color: #f0ff6c;" ngClass="sheet.isLiked ? 'liked' : 'not-liked'">
              {{ sheet.isLiked ? 'thumb_up' : 'thumb_up_off_alt' }}
            </mat-icon>
            <span class="like-count">{{ sheet.likes }}</span>
          </span>

          <span class="stat-item hearts" (click)="toggleFavorite(sheet)">
            <mat-icon style="color: #f85e5e;" ngClass="sheet.isFavorite ? 'liked' : 'not-liked'">
              {{ sheet.hearts ? 'favorite' : 'favorite_border' }}
            </mat-icon>
            <span class="hearts-count">{{ sheet.hearts }}</span>
          </span>

          <button class="button" (click)="goToSheetMusic(sheet)">
            VIEW
          </button>

        </div>
      </div>
    }
    @empty {
      <div class="no-results">×œ× × ××¦××• ×’×™×œ×™×•× ×•×ª ××•×–×™×§×œ×™×™× ×œ×”×¦×’×”.</div>
    }

  </div>

</div>
