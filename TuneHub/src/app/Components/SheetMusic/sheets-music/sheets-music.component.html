<div class="container">

  <!-- HEADER -->
  <header class="header">
    <div class="cover-wrapper">
      <img src="./assets/images/sheets_music.webp" class="cover-image" />
      <div class="overlay-content">
        <div class="title-section">
          <h1 class="musicians">Sheet Music Library</h1>
          <p>Discover, learn, and share musical scores from around the world</p>
        </div>

        <button class="button join-network-btn" (click)="openUploadModal()">
          <mat-icon>upload</mat-icon>
          Upload Sheet Music
        </button>
      </div>
    </div>
  </header>

  <!-- SEARCH & FILTERS -->
  <section class="search-bar">
    <div class="search-input-group">
      <span class="search-icon">ğŸ”</span>
      <input type="text" placeholder="Search musicians by name, instrument, or skills..." [(ngModel)]="searchText"/>
    </div>

    <select class="dropdown"><option>All</option></select>
    <select class="dropdown"><option>All</option></select>

    <button class="filters-btn" (click)="toggleFilters()">
      Filters <span class="arrow-icon">{{ showFilters ? 'âˆ§' : 'âˆ¨' }}</span>
    </button>
  </section>

  <!-- ADDITIONAL FILTERS -->
  <section class="additional-filters" *ngIf="showFilters">
    <div class="filter-group">
      <label>×›×œ×™ × ×’×™× ×”</label>
      <select class="dropdown" [(ngModel)]="selectedInstrument" (change)="applyFilters()">
        <option *ngFor="let instrument of instruments" [value]="instrument">{{ instrument }}</option>
      </select>
    </div>

    <div class="filter-group">
      <label>×¡×•×œ×</label>
      <select class="dropdown" [(ngModel)]="selectedScale" (change)="applyFilters()">
        <option *ngFor="let scale of scales" [value]="scale">{{ scale }}</option>
      </select>
    </div>

    <div class="filter-group">
      <label>×¨××ª ×§×•×©×™</label>
      <select class="dropdown" [(ngModel)]="selectedLevel" (change)="applyFilters()">
        <option *ngFor="let level of levels" [value]="level">{{ level }}</option>
      </select>
    </div>
  </section>

  <!-- CATEGORIES -->
  <section class="browse-categories-section">
    <h2 class="section-title">Browse by Category</h2>

    <div class="category-grid">
      <div class="category-card all-categories-card" 
           [class.selected]="selectedCategory === 'All'"
           (click)="selectCategory('All')">
        <div class="category-icon-wrapper"><mat-icon>folder</mat-icon></div>
        <div class="category-details">
          <h3 class="category-name">All Categories</h3>
          <p class="category-desc">Browse all sheet music</p>
          <span class="sheet-count">{{ originalSheetMusicList.length }} sheets</span>
        </div>
        <mat-icon *ngIf="selectedCategory === 'All'" class="check-icon">check_circle</mat-icon>
      </div>

      @for(categoryName of categories; track categoryName) {
        @if(categoryName !== 'All') {
          <div class="category-card" 
               [class.selected]="selectedCategory === categoryName"
               (click)="selectCategory(categoryName)">
            <div class="category-icon-wrapper" [style.background-color]="getCategoryColor(categoryName)">
              <mat-icon class="category-icon">{{ getCategoryIcon(categoryName) }}</mat-icon>
            </div>
            <div class="category-details">
              <h3 class="category-name">{{ categoryName }}</h3>
              <p class="category-desc">{{ getCategoryDescription(categoryName) }}</p>
              <span class="sheet-count">{{ countSheetsByCategory(categoryName) }} sheets</span>
            </div>
            <mat-icon *ngIf="selectedCategory === categoryName" class="check-icon">check_circle</mat-icon>
          </div>
        }
      }
    </div>
  </section>

  <!-- SHEET MUSIC LIST -->
  <div class="sheet-music-container">
    @for(sheet of sheetMusicList; track sheet.id) {
      <div class="music-card">
        <!-- COVER -->
        <div class="sheet-cover-header">
          <div class="cover-image">
            <img [src]="getImageCoverPath(sheet)" class="file-preview-iframe" />
            <div class="no-preview-overlay" *ngIf="!sheet.filePath">××™×Ÿ ×ª×¦×•×’×” ××§×“×™××”</div>
            <iframe *ngIf="sheet.filePath" [src]="getSafeMediaUrl(sheet.filePath)" class="file-preview-iframe"
                    title="×ª×¦×•×’×” ××§×“×™××” ×©×œ {{ sheet.name }}" allowfullscreen></iframe>
          </div>
        </div>

        <!-- BADGES -->
        <div class="badge-group">
          <span class="badge category" *ngFor="let category of sheet.category; let last = last" title="{{ category.name }}">
            <mat-icon>folder</mat-icon>
            {{ category.name }}<span *ngIf="!last"> â€¢ </span>
          </span>
          <span class="badge difficulty {{ sheet.level }}">{{ sheet.level }}</span>
        </div>

        <!-- CARD CONTENT -->
        <div class="card-content">
          <h3 class="title" [innerHTML]="sheet.title | highlight: searchText"></h3>
          <p class="artist-legacy">
            <span class="artist-mini-profile" (click)="navigationService.goToProfile(sheet.user.id)">
              <img [src]="fileUtilsService.getImageUrl(sheet.user.imageProfilePath)" class="artist-mini-img" alt="Profile" />
              <div class="sheet-rating-container">
                <span class="rating-value">{{ sheet.rating | number:'1.1-1' }}</span>
                <div class="stars-wrapper">
                  <mat-icon *ngFor="let starType of getStarArray(sheet.rating)" [ngClass]="{'filled-star': starType !== 'star_border'}">{{ starType }}</mat-icon>
                </div>
              </div>
              <span>{{ sheet.user.name }}</span>
            </span>
          </p>

          <div class="details-row">
            <div class="primary-tags">
              <span class="detail-tag"><mat-icon>description</mat-icon>{{ sheet.pages }}</span>
              <span class="detail-tag"><mat-icon>music_note</mat-icon>{{ sheet.scale }}</span>
              <span class="detail-tag">
                <ng-container *ngFor="let instrument of sheet.instruments; let last = last">
                  {{ instrument.name }}<span *ngIf="!last">, </span>
                </ng-container>
              </span>
            </div>
          </div>

          <div class="stats-row">
            <span class="stat-item"><mat-icon>download</mat-icon>{{ sheet.downloads }}</span>
            <span class="stat-item likes" (click)="toggleLike(sheet)">
              <mat-icon style="color:#f0ff6c" [ngClass]="sheet.isLiked ? 'liked' : 'not-liked'">
                {{ sheet.isLiked ? 'thumb_up' : 'thumb_up_off_alt' }}
              </mat-icon>
              <span class="like-count">{{ sheet.likes }}</span>
            </span>
            <span class="stat-item hearts" (click)="toggleFavorite(sheet)">
              <mat-icon style="color:#f85e5e" [ngClass]="sheet.isFavorite ? 'liked' : 'not-liked'">
                {{ sheet.isFavorite ? 'favorite' : 'favorite_border' }}
              </mat-icon>
              <span class="hearts-count">{{ sheet.hearts }}</span>
            </span>
          </div>

          <button class="button" (click)="goToSheetMusic(sheet)">VIEW</button>
        </div>

      </div>
    }
    @empty {
      <div class="no-results">×œ× × ××¦××• ×’×™×œ×™×•× ×•×ª ××•×–×™×§×œ×™×™× ×œ×”×¦×’×”.</div>
    }
  </div>

</div>
