<div class="container">

    <header class="header">
        <div class="cover-wrapper">
            <img src="./assets/images/posts.jpg" class="cover-image" />
            <div class="overlay-content">
                <div class="header-inner-content">
                    <h1 class="musicians" style="font-size:60px;">Posts & Vibes</h1>
                    <p style="font-size:25px;color:#fff">Create, share, and enjoy</p>

                    <button class="button join-network-btn">
                        Upload Post
                        <mat-icon>upload</mat-icon>
                    </button>
                </div>
            </div>
        </div>
    </header>

    @if(posts.length===0){
        <p class="no-posts"> 驻住 专注</p>
    }
    @else{

    <div class="posts-container">

        @for(post of posts; track $index){

        <div class="post-card">

            <header class="post-header">
                
                <img class="avatar"
                     [src]="fileUtils.getImageUrl(post.user?.imageProfilePath)"
                     alt="avatar">

                <div class="user-info">
                    <span class="username">{{post.user?.name}}</span>
                    <span class="date">{{post.dateUploaded | date:'short'}}</span>
                </div>

                <!-- 驻转专  砖转砖 专 -->
                <button *ngIf="!isAdmin"
                        class="action-btn report-btn"
                        (click)="onReportPost(post.id!)">
                    <mat-icon>report</mat-icon> 
                </button>

                <!-- 驻转专  -->
                <div *ngIf="isAdmin" class="post-actions-wrapper">
                    <button class="action-btn more-actions-btn"
                            (click)="toggleAdminActions(post.id!)">
                        <mat-icon>more_vert</mat-icon>
                    </button>

                    <div *ngIf="showAdminActions[post.id!]" class="admin-actions-dropdown">

                        <button class="action-btn delete-btn"
                                (click)="onDeletePost(post.id!)">
                            <mat-icon>delete</mat-icon> 拽
                        </button>

                        <button class="action-btn report-btn"
                                (click)="onReportPost(post.id!)">
                            <mat-icon>report</mat-icon> 
                        </button>

                    </div>
                </div>

            </header>

            <div class="post-body">

                <h3 class="post-title">{{post.title}}</h3>
                <p class="post-content">{{post.content}}</p>

                <div class="post-media">
                    
                    <div *ngFor="let image of post.imagesBase64" class="image-container">
                        <img [src]="fileUtils.getImageUrl(image)" class="post-image">
                    </div>

                    <audio *ngIf="post.audioPath" controls
                           [src]="getSafeMediaUrl('audio/' + post.audioPath)">
                    </audio>

                    <video *ngIf="post.videoPath" controls
                           [src]="getSafeMediaUrl('video/' + post.videoPath)">
                    </video>

                </div>
            </div>

            <footer class="post-footer">
                <div class="stats">
                    <span>わ {{post.hearts}}</span>
                    <span> {{post.likes}}</span>
                </div>
            </footer>

            <hr>

        </div>

        }

    </div>

    }

</div>
